name: Daily Commit & Visual Update

on:
  schedule:
    - cron: '0 0 * * *'  # Daily at midnight UTC
  workflow_dispatch:
  push:  # Run also on manual pushes
    branches:
      - main

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Git config
        run: |
          git config --global user.name "QuantumAlchemist03"
          git config --global user.email "QuantumAlchemist03@users.noreply.github.com"

      - name: Generate or update log and dashboard files
        env:
          DATE: ${{ steps.date.outputs.date }}
        run: |
          date=$(date)
          echo "Last updated on $date — run $RANDOM" > last-updated.txt

          echo "## 📝 TODO List\n\n- [ ] Task 1\n- [ ] Task 2\n\n_Last auto-generated on $date_" > TODO.md

          echo "## 📦 Changelog\n\n- $date: Daily automation run\n\n" >> CHANGELOG.md

          echo "Log entry at $date" >> log.txt

      - name: Commit changes
        run: |
          git add .
          git commit -m "🤖 Daily update: $date" || echo "No changes to commit"

      - name: Push changes
        env:
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
        run: |
          git remote set-url origin https://x-access-token:${PAT_TOKEN}@github.com/${{ github.repository }}.git
          git push origin main

      - name: Badge metadata
        run: |
          echo "![Last Updated](https://img.shields.io/date/$(date +%s)?label=Last%20Updated&color=green)" > README_BADGE.md

      - name: Commit badge
        run: |
          git add README_BADGE.md
          git commit -m "🛡️ Updated badge" || echo "No badge changes"
          git push origin main
